{"ast":null,"code":"import React,{createContext,useContext,useState,useEffect}from'react';import axios from'axios';import toast from'react-hot-toast';import{jsx as _jsx}from\"react/jsx-runtime\";const AdminAuthContext=/*#__PURE__*/createContext(undefined);export const AdminAuthProvider=_ref=>{let{children}=_ref;const[user,setUser]=useState(null);const[loading,setLoading]=useState(true);// Configure axios for admin panel\naxios.defaults.baseURL=process.env.REACT_APP_API_URL||'http://localhost:8013';useEffect(()=>{checkAuthStatus();},[]);const checkAuthStatus=async()=>{try{const token=localStorage.getItem('evep_admin_token');if(!token){setLoading(false);return;}// Set token in axios headers\naxios.defaults.headers.common['Authorization']=\"Bearer \".concat(token);// Verify token with backend\nconst response=await axios.get('/api/v1/auth/me');const userData=response.data;// Check if user is admin or super_admin\nif(userData.role==='admin'||userData.role==='super_admin'){setUser(userData);}else{// User is not admin, clear token\nlocalStorage.removeItem('evep_admin_token');delete axios.defaults.headers.common['Authorization'];toast.error('Access denied. Admin privileges required.');}}catch(error){console.error('Auth check failed:',error);localStorage.removeItem('evep_admin_token');delete axios.defaults.headers.common['Authorization'];}finally{setLoading(false);}};const login=async(email,password)=>{try{setLoading(true);const response=await axios.post('/api/v1/auth/login',{email,password});const{token,user:userData}=response.data;// Check if user is admin or super_admin\nif(userData.role!=='admin'&&userData.role!=='super_admin'){toast.error('Access denied. Admin privileges required.');return false;}// Store admin-specific token\nlocalStorage.setItem('evep_admin_token',token);axios.defaults.headers.common['Authorization']=\"Bearer \".concat(token);setUser(userData);toast.success(\"Welcome back, \".concat(userData.name||userData.email,\"!\"));return true;}catch(error){var _error$response,_error$response$data;console.error('Login failed:',error);const errorMessage=((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.detail)||'Login failed. Please try again.';toast.error(errorMessage);return false;}finally{setLoading(false);}};const logout=()=>{localStorage.removeItem('evep_admin_token');delete axios.defaults.headers.common['Authorization'];setUser(null);toast.success('Logged out successfully');};const value={user,loading,login,logout,isAuthenticated:!!user,isAdmin:(user===null||user===void 0?void 0:user.role)==='admin',isSuperAdmin:(user===null||user===void 0?void 0:user.role)==='super_admin'};return/*#__PURE__*/_jsx(AdminAuthContext.Provider,{value:value,children:children});};export const useAdminAuth=()=>{const context=useContext(AdminAuthContext);if(context===undefined){throw new Error('useAdminAuth must be used within an AdminAuthProvider');}return context;};","map":{"version":3,"names":["React","createContext","useContext","useState","useEffect","axios","toast","jsx","_jsx","AdminAuthContext","undefined","AdminAuthProvider","_ref","children","user","setUser","loading","setLoading","defaults","baseURL","process","env","REACT_APP_API_URL","checkAuthStatus","token","localStorage","getItem","headers","common","concat","response","get","userData","data","role","removeItem","error","console","login","email","password","post","setItem","success","name","_error$response","_error$response$data","errorMessage","detail","logout","value","isAuthenticated","isAdmin","isSuperAdmin","Provider","useAdminAuth","context","Error"],"sources":["/Users/kitkamon/Cursor/evep-my-firstcare-com/admin-panel/src/contexts/AdminAuthContext.tsx"],"sourcesContent":["import React, { createContext, useContext, useState, useEffect, ReactNode } from 'react';\nimport axios from 'axios';\nimport toast from 'react-hot-toast';\n\ninterface AdminUser {\n  _id: string;\n  email: string;\n  role: 'admin' | 'super_admin';\n  name: string;\n  is_active: boolean;\n  created_at: string;\n  last_login?: string;\n}\n\ninterface AdminAuthContextType {\n  user: AdminUser | null;\n  loading: boolean;\n  login: (email: string, password: string) => Promise<boolean>;\n  logout: () => void;\n  isAuthenticated: boolean;\n  isAdmin: boolean;\n  isSuperAdmin: boolean;\n}\n\nconst AdminAuthContext = createContext<AdminAuthContextType | undefined>(undefined);\n\ninterface AdminAuthProviderProps {\n  children: ReactNode;\n}\n\nexport const AdminAuthProvider: React.FC<AdminAuthProviderProps> = ({ children }) => {\n  const [user, setUser] = useState<AdminUser | null>(null);\n  const [loading, setLoading] = useState(true);\n\n  // Configure axios for admin panel\n  axios.defaults.baseURL = process.env.REACT_APP_API_URL || 'http://localhost:8013';\n\n  useEffect(() => {\n    checkAuthStatus();\n  }, []);\n\n  const checkAuthStatus = async () => {\n    try {\n      const token = localStorage.getItem('evep_admin_token');\n      if (!token) {\n        setLoading(false);\n        return;\n      }\n\n      // Set token in axios headers\n      axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;\n\n      // Verify token with backend\n      const response = await axios.get('/api/v1/auth/me');\n      const userData = response.data;\n\n      // Check if user is admin or super_admin\n      if (userData.role === 'admin' || userData.role === 'super_admin') {\n        setUser(userData);\n      } else {\n        // User is not admin, clear token\n        localStorage.removeItem('evep_admin_token');\n        delete axios.defaults.headers.common['Authorization'];\n        toast.error('Access denied. Admin privileges required.');\n      }\n    } catch (error) {\n      console.error('Auth check failed:', error);\n      localStorage.removeItem('evep_admin_token');\n      delete axios.defaults.headers.common['Authorization'];\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const login = async (email: string, password: string): Promise<boolean> => {\n    try {\n      setLoading(true);\n      \n      const response = await axios.post('/api/v1/auth/login', {\n        email,\n        password,\n      });\n\n      const { token, user: userData } = response.data;\n\n      // Check if user is admin or super_admin\n      if (userData.role !== 'admin' && userData.role !== 'super_admin') {\n        toast.error('Access denied. Admin privileges required.');\n        return false;\n      }\n\n      // Store admin-specific token\n      localStorage.setItem('evep_admin_token', token);\n      axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;\n      \n      setUser(userData);\n      toast.success(`Welcome back, ${userData.name || userData.email}!`);\n      return true;\n    } catch (error: any) {\n      console.error('Login failed:', error);\n      const errorMessage = error.response?.data?.detail || 'Login failed. Please try again.';\n      toast.error(errorMessage);\n      return false;\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const logout = () => {\n    localStorage.removeItem('evep_admin_token');\n    delete axios.defaults.headers.common['Authorization'];\n    setUser(null);\n    toast.success('Logged out successfully');\n  };\n\n  const value: AdminAuthContextType = {\n    user,\n    loading,\n    login,\n    logout,\n    isAuthenticated: !!user,\n    isAdmin: user?.role === 'admin',\n    isSuperAdmin: user?.role === 'super_admin',\n  };\n\n  return (\n    <AdminAuthContext.Provider value={value}>\n      {children}\n    </AdminAuthContext.Provider>\n  );\n};\n\nexport const useAdminAuth = (): AdminAuthContextType => {\n  const context = useContext(AdminAuthContext);\n  if (context === undefined) {\n    throw new Error('useAdminAuth must be used within an AdminAuthProvider');\n  }\n  return context;\n};\n\n\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}